flowchart LR

  %% Node declarations (REQUIRED by GitHub Mermaid)

  A[IFC Model Input]
  B[source]
  C[Semantic Graph]
  D[view]
  E[Active View]
  F[derive]
  G[Derived Dataset]
  H{Synthesize defined?}
  I[synthesize]
  J[Synthesized Dataset]
  K{Split defined?}
  L[split]
  M[Partitioned Dataset]
  N[export]
  O[Final Outputs]

  C1[Node Context]
  C2[Edge Context]
  C3[Batch Context]

  O1[Tabular Dataset]
  O2[Graph Dataset]
  O3[Text Corpus]

  %% Main execution flow

  A --> B
  B --> C
  C --> D
  D --> E
  E --> F
  F --> G

  G --> H
  H -->|Yes| I
  I --> J
  H -->|No| J

  J --> K
  K -->|Yes| L
  L --> M
  K -->|No| M

  M --> N
  N --> O

  %% Context links

  F -.-> C1
  D -.-> C1
  D -.-> C2
  L -.-> C3
  N -.-> C3

  %% Subgraphs (ONLY grouping, no definitions)

  subgraph Contexts
    direction TB
    C1
    C2
    C3
  end

  subgraph Outputs
    direction TB
    O1
    O2
    O3
  end

  O --> O1
  O --> O2
  O --> O3
