flowchart LR

  %% -------------------------------------------------
  %% OpenBIM-DL Execution Flow
  %% -------------------------------------------------

  A[IFC Model Input] --> B[source]

  %% SOURCE
  B -->|Initialize model context| C[Semantic Graph]
  C --> D[view]

  %% VIEW
  D -->|Select nodes / edges| E[Active View]
  E --> F[derive]

  %% DERIVE
  F -->|Evaluate expressions per context| G[Derived Dataset]

  %% SYNTHESIZE (optional)
  G --> H{Synthesize defined?}
  H -->|Yes| I[synthesize]
  I -->|Apply controlled perturbations| J[Synthesized Dataset]
  H -->|No| J

  %% SPLIT (optional)
  J --> K{Split defined?}
  K -->|Yes| L[split]
  L -->|Batch grouping / anti-leakage| M[Partitioned Dataset]
  K -->|No| M

  %% EXPORT
  M --> N[export]
  N --> O[Final Outputs]

  %% -------------------------------------------------
  %% Context Annotations
  %% -------------------------------------------------

  subgraph Contexts
    C1[Node Context\n(per entity)]
    C2[Edge Context\n(per relation)]
    C3[Batch Context\n(global)]
  end

  F -.-> C1
  D -.-> C1
  D -.-> C2
  L -.-> C3
  N -.-> C3

  %% -------------------------------------------------
  %% Output Types
  %% -------------------------------------------------

  subgraph Outputs
    O1[Tabular Dataset\n(CSV / Parquet / JSONL)]
    O2[Graph Dataset\n(edge_list)]
    O3[Text Corpus\n(Embeddings)]
  end

  O --> O1
  O --> O2
  O --> O3
